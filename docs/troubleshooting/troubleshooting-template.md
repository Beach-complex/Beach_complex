# Troubleshooting Template

> 목적: 문제를 **재현 가능하게 기록**하고, **원인/해결/검증/재발방지**까지 남겨 다음 번 해결 시간을 줄인다.  
> 사용 가이드: 기본은 **DEV 모드(A 필수)**만 작성. 배포/운영 이슈거나 사용자 영향이 있으면 **OPS 섹션(B 옵션)**까지 작성.

---

## 0) 메타 정보

- **Mode:** `DEV` / `OPS`
- **Status:** `Open` / `In Progress` / `Resolved` / `Won't Fix`
- **작성자:** <!-- 이름(@githubid) -->
- **작성일:** <!-- YYYY-MM-DD -->
- **컴포넌트:** <!-- 예: api, auth, reservation, db, infra, batch -->
- **환경:** <!-- local / dev / staging / prod -->
- **관련 이슈/PR:** <!-- 링크 -->
- **키워드:** <!-- 에러코드/예외명/증상 키워드 -->

---

## 1) 요약 (3줄)

- **무슨 문제였나:** <!-- 한 문장 -->
- **원인:** <!-- 한 문장, 근거 기반 -->
- **해결:** <!-- 한 문장, 변경 포인트 -->

## 1-1) 학습 포인트 (최대 3개)

> 감상/다짐 금지. “다음에 시간을 줄이는 것”만. Rule of thumb은 필수, 나머지는 선택.

- **Fast checks (3):** (1) Log: ___  (2) Config/Env: ___  (3) Infra/Dependency: ___
- **Rule of thumb (필수, 1문장):** ___
- **Anti-pattern (선택):** ___

---

## 2) 증상 (Symptom)

### 관측된 현상
- <!-- 예: 특정 API 호출 시 500 발생 -->
- <!-- 예: 통합테스트 간헐적 실패 -->

### 에러 메시지 / 스택트레이스 (필수)
```text
붙여넣기
```

### 발생 조건 / 빈도
- **언제:** <!-- 특정 시간대/특정 요청/특정 데이터 -->
- **빈도:** <!-- 항상/간헐/특정 사용자/특정 케이스 -->

---

## 3) 영향 범위 (DEV 기준 최소 작성)

- **영향받는 기능:** <!-- 예: 예약 생성 -->
- **영향받는 사용자/데이터:** <!-- DEV면 "테스트 데이터만" 같은 식으로 명시 -->
- **심각도(개발 단계):** `Low` / `Medium` / `High`  
  - Low: 개발자만 불편, 우회 가능  
  - Medium: 기능 개발/테스트 진행이 막힘  
  - High: 데이터 손상 위험 또는 핵심 기능 완전 차단

---

## 4) 재현 방법 (Reproduction)

> 다른 사람이 그대로 따라 했을 때 동일 증상이 나와야 한다.

### 전제 조건
- **브랜치/커밋:** <!-- commit sha -->
- **의존성/버전:** <!-- Java, Spring Boot, Gradle, DB(Postgres), Docker 등 -->
- **환경변수/설정:** <!-- 예: SPRING_PROFILES_ACTIVE=test -->

### 재현 절차
1. <!-- step 1 -->
2. <!-- step 2 -->
3. <!-- step 3 -->

### 재현 입력/데이터
- 요청/페이로드/SQL/테스트 케이스:
```text
붙여넣기
```

---

## 5) 원인 분석 (Root Cause)

> “추정”이 아니라 “근거”로 확정한다.

### 가설 목록 (필요 시)
- [ ] 가설 1: <!-- -->
- [ ] 가설 2: <!-- -->

### 근거 (로그/코드/설정/DB 상태)
- **로그/지표:** <!-- 어떤 로그 라인이 결정적이었는지 -->
- **코드 포인트:** <!-- 파일/라인/메서드 -->
- **설정 포인트:** <!-- application.yml, docker-compose, gradle 등 -->
- **DB 상태:** <!-- 마이그레이션/스키마/데이터 -->

### 최종 원인 (One-liner)
- <!-- 예: 트랜잭션 경계 밖에서 lazy 로딩 발생 -> LazyInitializationException -->

---

## 6) 해결 (Fix)

### 해결 전략
- **유형:** `Hotfix` / `Refactor` / `Config change` / `Data fix` / `Rollback` (DEV면 해당 없음)
- **접근:** <!-- 왜 이 방법이 최선인지 한 문장 -->

### 변경 사항
- <!-- bullet로 요약 -->
- 관련 코드/설정 diff 또는 링크:
  - PR: <!-- 링크 -->
  - Commit: <!-- sha -->

### 주의/부작용
- <!-- 예: 성능 영향, 호환성, 데이터 마이그레이션 필요 등 -->

---

## 7) 검증 (Verification)

### 해결 확인
- [ ] 동일 재현 절차로 더 이상 발생하지 않음
- [ ] 관련 테스트 통과 (unit/integration)
- [ ] 로컬 실행/빌드 정상

### 실행한 커맨드/테스트
```bash
# 예시
./gradlew test
./gradlew integrationTest
```

### 추가 확인(선택)
- 성능/부하에 영향 없는지:
- 회귀 가능성 체크:

---

## 8) 재발 방지 (Prevention)

> “다음에 더 빨리 잡히게” 만드는 항목이 핵심이다.

### 방지 조치 체크리스트
- [ ] **테스트 추가**: <!-- 어떤 케이스를 어떤 레벨에서 -->
- [ ] **검증 로직 추가**: <!-- 예: 입력 검증/상태 체크 -->
- [ ] **가드레일**: <!-- 예: Feature flag, 제한 조건 -->
- [ ] **로깅 개선**: <!-- 에러 원인 파악에 필요한 로그 추가 -->
- [ ] **문서화**: <!-- README/Runbook/ADR 등 -->
- [ ] **알림/모니터링**(배포 후): <!-- OPS 섹션 참고 -->

### 남은 작업(Action Items)
- [ ] <!-- TODO 1: 담당자/기한(선택) -->
- [ ] <!-- TODO 2 -->

---

# OPS 섹션 (배포/운영 시에만 작성)

## 9) 운영 영향(Impact)

- **영향 기간:** <!-- YYYY-MM-DD HH:MM ~ HH:MM -->
- **사용자 영향:** <!-- 몇 명/어떤 기능 -->
- **데이터 손상 여부:** `Yes` / `No` / `Unknown`
- **심각도(운영):** `SEV1` / `SEV2` / `SEV3`
  - SEV1: 서비스 핵심 기능 마비/대규모 영향
  - SEV2: 부분 장애/우회 가능하나 영향 큼
  - SEV3: 제한적 영향/모니터링 수준

---

## 10) 타임라인 (Timeline)

> 시간 순으로 “무슨 판단을 했는지”가 중요하다.

- **감지:** <!-- HH:MM 알람/리포트 -->
- **인지:** <!-- HH:MM 담당자 확인 -->
- **완화(임시 조치):** <!-- HH:MM -->
- **복구:** <!-- HH:MM -->
- **근본 해결 배포:** <!-- HH:MM -->
- **사후 조치 완료:** <!-- 날짜 -->

---

## 11) 임시 조치 (Mitigation)

- **조치 내용:** <!-- 예: 롤백, 재시작, 트래픽 차단, 플래그 off -->
- **근거/리스크:** <!-- 왜 했고, 위험은 무엇이었는지 -->
- **효과:** <!-- 5xx 감소, 지연시간 정상화 등 -->

---

## 12) 모니터링/알람 개선 (Observability)

- **추가해야 할 알람:** <!-- 예: 5xx 비율, 특정 예외 카운트 -->
- **대시보드/지표:** <!-- 무엇을 봐야 빠르게 판단 가능한지 -->
- **로그/트레이싱:** <!-- correlation id, request id 등 -->

---

## 13) 런북 업데이트 (Runbook)

- [ ] 장애 대응 절차 문서화
- [ ] 점검 커맨드/대시보드 링크 추가
- [ ] 롤백/핫픽스 기준 정리
